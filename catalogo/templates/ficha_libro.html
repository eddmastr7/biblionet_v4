<h1>Ficha Detallada: {{ libro.titulo }}</h1>
<p><strong>Autor:</strong> {{ libro.autor }}</p>

<p>
Â  Â  <strong>Disponibilidad:</strong>
Â  Â  {% if libro.stock_disponible > 0 %}  Â  Â  Â  Â  <span style="color: green; font-weight: bold;">âœ… Disponible para PrÃ©stamo</span>
Â  Â  {% else %}
Â  Â  Â  Â  <span style="color: red; font-weight: bold;">âŒ Actualmente Prestado/Reservado</span>
Â  Â  {% endif %}
</p>

<hr>

{# ğŸ¯ VERIFICACIÃ“N CRÃTICA: Â¿El cliente estÃ¡ logueado? #}
{% if request.session.cliente_id %}
    
    {% if not libro.disponible %}
        <form method="POST" action="{% url 'solicitar_reserva' libro.pk %}">
            {% csrf_token %} 
            <button type="submit" 
                    style="background-color: #ffc107; color: black; padding: 10px; border: none; cursor: pointer;">
                Reservar Libro (Lista de Espera)
            </button>
        </form>
    {% else %}
        <p>El libro estÃ¡ disponible. Puedes solicitar el prÃ©stamo en el mostrador.</p>
    {% endif %}

{% else %}
    
    {% if not libro.disponible %}
        <div class="alert alert-warning" role="alert" style="padding: 10px; border: 1px solid #ffc107;">
            Para reservar este libro (actualmente no disponible), debes 
            <a href="{% url 'inicio_sesion_cliente' %}" class="alert-link">iniciar sesiÃ³n</a>.
        </div>
    {% else %}
        <p>El libro estÃ¡ disponible. Puedes solicitar el prÃ©stamo en el mostrador.</p>
    {% endif %}

{% endif %}

<hr>
<a href="{% url 'catalogo' %}">â† Volver al CatÃ¡logo</a>